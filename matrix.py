from datetime import datetime
from values import matrix, tasks


def get_matrix_value(full_array, number: int) -> str:
    """
    –ê–±—Å–æ–ª—é—Ç–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ getMatrixValue –∏–∑ App.tsx
    """
    count = full_array.count(number)

    if count == 0:
        key = f"{number}0"
    elif count > 5:
        key = str(number) * (count - 5)
    else:
        key = str(number) * count

    return matrix.get(key, "‚Äî")


def build_matrix_text(matrix_data):
    full = matrix_data["full"]

    text = "üî¢ *–ú–ê–¢–†–ò–¶–ê –°–£–î–¨–ë–´*\n\n"
    
    # –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã
    for n in range(1, 10):
        count = full.count(n)
        value = get_matrix_value(full, n)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏
        if count == 0:
            level = "‚ö™ –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
        elif count == 1:
            level = "üü° –ë–∞–∑–æ–≤–∞—è"
        elif count == 2:
            level = "üü† –£—Å–∏–ª–µ–Ω–Ω–∞—è"
        elif count == 3:
            level = "üî¥ –°–∏–ª—å–Ω–∞—è"
        elif count >= 4:
            level = "üü£ –û—á–µ–Ω—å —Å–∏–ª—å–Ω–∞—è"
        
        text += f"*{n}* ({count}—à—Ç, {level}):\n"
        text += f"{value}\n\n"

    return text


def build_tasks_text(matrix_data):
    soul_task = tasks.get(str(matrix_data["second"]), "")
    clan_task = tasks.get(str(matrix_data["fourth"]), "")

    text = "üéØ *–ö–ê–†–ú–ò–ß–ï–°–ö–ò–ï –ó–ê–î–ê–ß–ò*\n\n"
    
    if soul_task:
        text += f"*–î—É—à–∞ (—á–∏—Å–ª–æ {matrix_data['second']}):*\n"
        text += f"‚ú® {soul_task}\n\n"
    
    if clan_task:
        text += f"*–†–æ–¥ (—á–∏—Å–ª–æ {matrix_data['fourth']}):*\n"
        text += f"üèõ {clan_task}\n\n"
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    text += "*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
    text += "‚Ä¢ –≠—Ç–∏ –∑–∞–¥–∞—á–∏ ‚Äî –≤–∞—à –ø—É—Ç—å –∫ –≥–∞—Ä–º–æ–Ω–∏–∏\n"
    text += "‚Ä¢ –ö–∞–∂–¥–æ–µ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ\n"
    text += "‚Ä¢ –û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–∏—Ç—É–∞—Ü–∏–∏\n"

    return text


def daily_horoscope(matrix_data):
    today = datetime.now().strftime("%d.%m.%Y")
    current_day = datetime.now().day
    current_month = datetime.now().month
    
    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é –¥–Ω—è
    day_energy = (current_day + current_month) % 9 or 9
    personal_energy = (day_energy + matrix_data["second"]) % 9 or 9
    
    # –ë–µ—Ä–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –¥–Ω—è
    energy_desc = {
        1: "–Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π –∏ –ª–∏–¥–µ—Ä—Å—Ç–≤–∞",
        2: "–≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–∞", 
        3: "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –∏ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è",
        4: "—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä—É–¥–∞",
        5: "—Å–≤–æ–±–æ–¥—ã –∏ –ø–µ—Ä–µ–º–µ–Ω",
        6: "—Å–µ–º—å–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏",
        7: "–∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞",
        8: "–∏–∑–æ–±–∏–ª–∏—è –∏ –≤–ª–∞—Å—Ç–∏",
        9: "–∑–∞–≤–µ—Ä—à–µ–Ω–∏–π –∏ –º—É–¥—Ä–æ—Å—Ç–∏"
    }.get(personal_energy, "–æ—Å–æ–±—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π")

    return f"""
‚ú® *–ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ô –ü–†–û–ì–ù–û–ó –ù–ê {today}*

*–≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è:* {personal_energy} ({energy_desc})

*–§–æ–∫—É—Å –≤–Ω–∏–º–∞–Ω–∏—è:* —á–∏—Å–ª–æ {matrix_data['second']}
*–ö–∞—Ä–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:* —á–∏—Å–ª–æ {matrix_data['fourth']}

*–ß—Ç–æ —Å–µ–≥–æ–¥–Ω—è –≤–∞–∂–Ω–æ:*
1. –ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–∞ —á–∏—Å–ª–∞ {matrix_data['second']}
2. –û–±—Ä–∞—â–∞–π—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–∏—Ç—É–∞—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —á–∏—Å–ª–æ–º {matrix_data['fourth']}
3. –î–æ–≤–µ—Ä—è–π—Ç–µ —Å–≤–æ–µ–π –∏–Ω—Ç—É–∏—Ü–∏–∏
4. –î–µ–π—Å—Ç–≤—É–π—Ç–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ

*–°–æ–≤–µ—Ç –¥–Ω—è:*
–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —ç–Ω–µ—Ä–≥–∏—è –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç—Å—Ç–≤—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è–º –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤–∞—à–µ–π –∏—Å—Ç–∏–Ω–Ω–æ–π –ø—Ä–∏—Ä–æ–¥–æ–π. 
–õ—é–±–æ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—â—É—â–∞—Ç—å—Å—è —Å–∏–ª—å–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ.
"""
